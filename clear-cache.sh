#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะฑััััะพะน ะพัะธััะบะธ ะบััะฐ

echo "๐งน ะััััะฐั ะพัะธััะบะฐ ะบััะฐ Linux Server Manager"
echo "============================================"

WEB_ROOT="/var/www/html/linux-server-manager"
CACHE_DIR="$WEB_ROOT/cache"

# ะัะพะฒะตััะตะผ, ััะพ ัะบัะธะฟั ะทะฐะฟััะตะฝ ั ะฟัะฐะฒะฐะผะธ root
if [ "$EUID" -ne 0 ]; then
    echo "โ ะญัะพั ัะบัะธะฟั ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟััะตะฝ ั ะฟัะฐะฒะฐะผะธ root (sudo)"
    exit 1
fi

# ะัะพะฒะตััะตะผ ัััะตััะฒะพะฒะฐะฝะธะต ะดะธัะตะบัะพัะธะธ ะบััะฐ
if [ ! -d "$CACHE_DIR" ]; then
    echo "๐ ะกะพะทะดะฐะตะผ ะดะธัะตะบัะพัะธั ะบััะฐ..."
    mkdir -p "$CACHE_DIR"
    chown www-data:www-data "$CACHE_DIR"
    chmod 755 "$CACHE_DIR"
fi

# ะัะธัะฐะตะผ ะบัั
echo "๐๏ธ ะัะธัะฐะตะผ ะบัั..."
deleted_count=$(find "$CACHE_DIR" -name "*.cache" -delete 2>/dev/null | wc -l)

if [ "$deleted_count" -gt 0 ]; then
    echo "โ ะฃะดะฐะปะตะฝะพ ัะฐะนะปะพะฒ ะบััะฐ: $deleted_count"
else
    echo "๐ญ ะัั ัะถะต ะฟััั"
fi

# ะะพะบะฐะทัะฒะฐะตะผ ััะฐัะธััะธะบั
echo ""
echo "๐ ะกัะฐัะธััะธะบะฐ ะฟะพัะปะต ะพัะธััะบะธ:"
echo "----------------------------"
total_files=$(find "$CACHE_DIR" -name "*.cache" 2>/dev/null | wc -l)
total_size=$(du -sh "$CACHE_DIR" 2>/dev/null | cut -f1)

echo "๐ ะคะฐะนะปะพะฒ ะฒ ะบััะต: $total_files"
echo "๐พ ะะฐะทะผะตั ะบััะฐ: $total_size"

echo ""
echo "๐ฏ ะัั ะพัะธัะตะฝ! ะัะธ ัะปะตะดัััะตะผ ะฟะพัะตัะตะฝะธะธ ะผะตะดะปะตะฝะฝัั ัััะฐะฝะธั ะดะฐะฝะฝัะต ะฑัะดัั ะทะฐะณััะถะตะฝั ะทะฐะฝะพะฒะพ."
